<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>P2P Pay - Sistema de Pagos</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #1a1a1a;
        min-height: 100vh;
        padding: 0;
        color: #e0e0e0;
      }
      
      .navbar {
        background: rgba(30, 30, 30, 0.95);
        backdrop-filter: blur(10px);
        padding: 1rem 2rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        border-bottom: 1px solid rgba(100, 100, 100, 0.2);
      }
      
      .navbar h1 {
        color: #a0a0a0;
        font-size: 1.5rem;
      }
      
      .navbar-nav {
        display: flex;
        gap: 1rem;
      }
      
      .nav-btn {
        padding: 0.5rem 1.5rem;
        background: transparent;
        border: 2px solid #555;
        color: #b0b0b0;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }
      
      .nav-btn:hover {
        background: #444;
        border-color: #666;
        color: #d0d0d0;
      }
      
      .nav-btn.active {
        background: #3a3a3a;
        border-color: #666;
        color: #e0e0e0;
      }
      
      .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: #b0b0b0;
      }
      
      .user-address {
        font-size: 0.9rem;
        color: #888;
      }
      
      .view-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 2rem;
      }
      
      .view {
        display: none;
        animation: fadeIn 0.3s;
      }
      
      .view.active {
        display: block;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .card {
        background: #2a2a2a;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(100, 100, 100, 0.2);
      }
      
      .card h2 {
        color: #b0b0b0;
        margin-bottom: 1.5rem;
        font-size: 1.8rem;
      }
      
      .card h3 {
        color: #c0c0c0;
        margin-bottom: 1rem;
        font-size: 1.3rem;
      }
      
      .form-group {
        margin-bottom: 1.5rem;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #c0c0c0;
        font-weight: 600;
      }
      
      .form-group input,
      .form-group select {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #444;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s;
        background: #1a1a1a;
        color: #e0e0e0;
      }
      
      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #666;
        background: #222;
      }
      
      .form-group input[readonly] {
        background: #252525;
        color: #999;
      }
      
      .btn {
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-right: 0.5rem;
        margin-top: 0.5rem;
      }
      
      .btn-primary {
        background: #444;
        color: #e0e0e0;
        border: 1px solid #555;
      }
      
      .btn-primary:hover {
        background: #555;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      }
      
      .btn-secondary {
        background: #3a3a3a;
        color: #c0c0c0;
        border: 1px solid #555;
      }
      
      .btn-secondary:hover {
        background: #4a4a4a;
      }
      
      .btn-success {
        background: #2d4a2d;
        color: #a0d0a0;
        border: 1px solid #3d5a3d;
      }
      
      .btn-success:hover {
        background: #3d5a3d;
      }
      
      .btn-danger {
        background: #4a2d2d;
        color: #d0a0a0;
        border: 1px solid #5a3d3d;
      }
      
      .btn-danger:hover {
        background: #5a3d3d;
      }
      
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      
      .balance-display {
        background: #2a2a2a;
        color: #e0e0e0;
        padding: 2rem;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 2rem;
        border: 1px solid rgba(100, 100, 100, 0.3);
      }
      
      .balance-display h3 {
        color: #b0b0b0;
        margin-bottom: 0.5rem;
      }
      
      .balance-amount {
        font-size: 3rem;
        font-weight: bold;
        margin: 1rem 0;
        color: #d0d0d0;
      }
      
      .balance-label {
        font-size: 0.9rem;
        opacity: 0.7;
        color: #999;
      }
      
      .wallet-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 2rem;
      }
      
      .action-card {
        background: #252525;
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
      }
      
      .action-card:hover {
        border-color: #555;
        background: #2d2d2d;
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      }
      
      .action-card h4 {
        color: #b0b0b0;
        margin-bottom: 0.5rem;
      }
      
      .action-card p {
        color: #888;
      }
      
      .status-message {
        padding: 1rem;
        border-radius: 8px;
        margin-top: 1rem;
      }
      
      .status-success {
        background: #2d4a2d;
        color: #a0d0a0;
        border: 1px solid #3d5a3d;
      }
      
      .status-error {
        background: #4a2d2d;
        color: #d0a0a0;
        border: 1px solid #5a3d3d;
      }
      
      .status-info {
        background: #2d3d4a;
        color: #a0c0d0;
        border: 1px solid #3d4d5a;
      }
      
      .login-container {
        max-width: 500px;
        margin: 5rem auto;
      }
      
      .login-card {
        text-align: center;
      }
      
      .login-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }
      
      .p2p-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
      }
      
      .p2p-user {
        background: #252525;
        padding: 1.5rem;
        border-radius: 10px;
        border: 2px solid #444;
      }
      
      .p2p-user.active {
        border-color: #666;
        background: #2d2d2d;
      }
      
      .p2p-user h4 {
        color: #b0b0b0;
        margin-bottom: 1rem;
      }
      
      .account-selector {
        margin-bottom: 1rem;
      }
      
      .qr-code {
        text-align: center;
        padding: 1rem;
        background: #1a1a1a;
        border-radius: 8px;
        margin-top: 1rem;
        border: 1px solid #444;
      }
      
      .qr-code p {
        color: #888;
      }
      
      @media (max-width: 768px) {
        .navbar {
          flex-direction: column;
          gap: 1rem;
        }
        
        .navbar-nav {
          flex-wrap: wrap;
          justify-content: center;
        }
        
        .p2p-container {
          grid-template-columns: 1fr;
        }
        
        .view-container {
          padding: 0 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <h1> P2P Pay</h1>
      <div class="navbar-nav" id="navbarNav">
        <button class="nav-btn" data-view="login">Inicio de Sesi贸n</button>
        <button class="nav-btn" data-view="wallet">Billetera</button>
        <button class="nav-btn" data-view="p2p">Modo P2P</button>
      </div>
      <div class="user-info" id="userInfo" style="display: none;">
        <span class="user-address" id="userAddress"></span>
      </div>
    </nav>

    <!-- View Container -->
    <div class="view-container">
      <!-- Login View -->
      <div id="loginView" class="view active">
        <div class="login-container">
          <div class="card login-card">
            <div class="login-icon"></div>
            <h2>Inicio de Sesi贸n</h2>
            <p style="color: #666; margin-bottom: 2rem;">Conecta tu billetera MetaMask para comenzar</p>
            
            <div id="loginStatus"></div>
            
            <button class="btn btn-primary" id="btnLogin" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
               Conectar MetaMask
            </button>
            
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(100, 100, 100, 0.3);">
              <details style="margin-bottom: 1.5rem;">
                <summary style="cursor: pointer; color: #888; font-size: 0.9rem; margin-bottom: 0.5rem;">
                  锔 Configuraci贸n avanzada (Contrato)
                </summary>
                <div style="margin-top: 1rem; padding: 1rem; background: #1a1a1a; border-radius: 8px; border: 1px solid rgba(100, 100, 100, 0.2);">
                  <p style="color: #666; font-size: 0.85rem; margin-bottom: 1rem;">
                    La aplicaci贸n detecta autom谩ticamente el contrato. Si necesitas usar un contrato diferente:
                  </p>
                  <div class="form-group">
                    <label style="color: #888; font-size: 0.9rem;">Direcci贸n del contrato (opcional):</label>
                    <input 
                      type="text" 
                      id="contractAddressInput" 
                      placeholder="0x..." 
                      style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; background: #1a1a1a; color: #e0e0e0; border: 2px solid #444; border-radius: 8px;"
                    />
                  </div>
                  <button 
                    id="btnSetContract" 
                    class="btn" 
                    style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: #3a3a3a; color: #b0b0b0; border: 1px solid #555;"
                  >
                    Configurar Contrato
                  </button>
                  <p style="color: #666; font-size: 0.75rem; margin-top: 1rem;">
                     Tambi茅n puedes usar la URL con par谩metro: <code style="color: #888;">?contract=0x...</code>
                  </p>
                  <div id="contractInfo" style="margin-top: 0.5rem; color: #888; font-size: 0.85rem;"></div>
                </div>
              </details>
              
              <h3 style="font-size: 1rem; margin-bottom: 1rem; color: #b0b0b0;">Cuentas disponibles</h3>
              <div id="accountSelectorContainer" style="display: none;">
                <select id="accountSelect" class="form-group" style="width: 100%; padding: 0.75rem;">
                  <option value="">Selecciona una cuenta...</option>
                </select>
              </div>
              <div id="accountInfo" style="margin-top: 1rem; color: #666;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Wallet View -->
      <div id="walletView" class="view">
        <div class="balance-display">
          <h3>Tu Billetera</h3>
          <div class="balance-amount" id="walletBalance">0.00 ETH</div>
          <div class="balance-label" id="walletAddress">No conectado</div>
        </div>

        <div class="card">
          <h2>Acciones</h2>
          <div class="wallet-actions">
            <div class="action-card" data-action="send">
              <h4> Enviar</h4>
              <p>Env铆a ETH a otra direcci贸n</p>
            </div>
            <div class="action-card" data-action="receive">
              <h4> Recibir</h4>
              <p>Muestra tu direcci贸n para recibir</p>
            </div>
            <div class="action-card" data-action="withdraw">
              <h4> Retirar</h4>
              <p>Retira fondos del contrato</p>
            </div>
          </div>
        </div>

        <!-- Send Subview -->
        <div id="sendSubview" class="card" style="display: none;">
          <h3> Enviar Dinero</h3>
          <div class="form-group">
            <label>Direcci贸n destino</label>
            <input type="text" id="sendToAddress" placeholder="0x..." />
          </div>
          <div class="form-group">
            <label>Cantidad (ETH)</label>
            <input type="number" id="sendAmount" placeholder="0.1" step="0.001" />
          </div>
          <div class="form-group">
            <label>Referencia (opcional)</label>
            <input type="text" id="sendReference" placeholder="Pago de factura..." maxlength="32" />
          </div>
          <button class="btn btn-primary" id="btnSend">Enviar</button>
          <button class="btn btn-secondary" id="btnCancelSend">Cancelar</button>
          <div id="sendStatus"></div>
        </div>

        <!-- Receive Subview -->
        <div id="receiveSubview" class="card" style="display: none;">
          <h3> Recibir Dinero</h3>
          <div class="form-group">
            <label>Tu direcci贸n</label>
            <input type="text" id="receiveAddress" readonly style="background: #f8f9fa;" />
          </div>
          <div class="qr-code">
            <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
            <p style="color: #666;">Escanea este c贸digo QR o comparte tu direcci贸n</p>
            <div id="qrCode" style="margin-top: 1rem;"></div>
          </div>
          <button class="btn btn-secondary" id="btnCopyAddress"> Copiar Direcci贸n</button>
          <button class="btn btn-secondary" id="btnCancelReceive">Cerrar</button>
        </div>

        <!-- Withdraw Subview -->
        <div id="withdrawSubview" class="card" style="display: none;">
          <h3> Retirar Dinero</h3>
          <div class="form-group">
            <label>Tu direcci贸n</label>
            <input type="text" id="withdrawAddress" readonly style="background: #f8f9fa;" />
          </div>
          <div class="form-group">
            <label>Balance en contrato</label>
            <input type="text" id="contractBalance" readonly style="background: #f8f9fa;" />
          </div>
          <button class="btn btn-danger" id="btnWithdraw">Retirar Todo</button>
          <button class="btn btn-secondary" id="btnCancelWithdraw">Cancelar</button>
          <div id="withdrawStatus"></div>
        </div>

        <div id="walletStatus"></div>
      </div>

      <!-- P2P View -->
      <div id="p2pView" class="view">
        <div class="card">
          <h2> Modo P2P</h2>
          <p style="color: #666; margin-bottom: 2rem;">Conecta dos cuentas diferentes para realizar transacciones P2P</p>
          
          <div class="p2p-container">
            <div class="p2p-user" id="p2pUser1">
              <h4> Usuario 1</h4>
              <div class="form-group account-selector">
                <label>Cuenta</label>
                <select id="p2pAccount1" class="form-group">
                  <option value="">Selecciona cuenta...</option>
                </select>
              </div>
              <div class="form-group">
                <label>Direcci贸n</label>
                <input type="text" id="p2pAddress1" readonly style="background: #f8f9fa;" />
              </div>
              <div class="form-group">
                <label>Balance</label>
                <input type="text" id="p2pBalance1" readonly style="background: #f8f9fa;" />
              </div>
            </div>

            <div class="p2p-user" id="p2pUser2">
              <h4> Usuario 2</h4>
              <div class="form-group account-selector">
                <label>Cuenta</label>
                <select id="p2pAccount2" class="form-group">
                  <option value="">Selecciona cuenta...</option>
                </select>
              </div>
              <div class="form-group">
                <label>Direcci贸n</label>
                <input type="text" id="p2pAddress2" readonly style="background: #f8f9fa;" />
              </div>
              <div class="form-group">
                <label>Balance</label>
                <input type="text" id="p2pBalance2" readonly style="background: #f8f9fa;" />
              </div>
            </div>
          </div>

          <div class="card" style="margin-top: 2rem;">
            <h3> Realizar Transacci贸n P2P</h3>
            <div class="form-group">
              <label>De (Usuario)</label>
              <select id="p2pFromUser">
                <option value="">Selecciona...</option>
                <option value="1">Usuario 1</option>
                <option value="2">Usuario 2</option>
              </select>
            </div>
            <div class="form-group">
              <label>Para (Usuario)</label>
              <select id="p2pToUser">
                <option value="">Selecciona...</option>
                <option value="1">Usuario 1</option>
                <option value="2">Usuario 2</option>
              </select>
            </div>
            <div class="form-group">
              <label>Cantidad (ETH)</label>
              <input type="number" id="p2pAmount" placeholder="0.1" step="0.001" />
            </div>
            <div class="form-group">
              <label>Referencia (opcional)</label>
              <input type="text" id="p2pReference" placeholder="Pago P2P..." maxlength="32" />
            </div>
            <button class="btn btn-primary" id="btnP2PSend">Enviar Transacci贸n</button>
            <div id="p2pStatus"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="metamask_p2p.js?v=2"></script>
    <script src="app.js"></script>
  </body>
</html>
